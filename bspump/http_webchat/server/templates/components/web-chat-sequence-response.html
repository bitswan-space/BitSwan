<div id="webchat-response-sequence" class="w-full flex flex-col items-end"></div>

<script>
(function() {
    const responses = JSON.parse({{ responses | tojson | safe }});
      let current = 0;

      function showNext() {
        if (current >= responses.length) return;

        const responseHTML = responses[current];
        const container = document.getElementById('webchat-response-sequence');
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = responseHTML;
        const response = tempDiv.querySelector('.webchat_response');

        if (response) {
          container.appendChild(response);
        }

        if (response.id === 'webchat-response-with-prompt') {
          const formWrapper = tempDiv.querySelector('#prompt-input');
          if (formWrapper) {
            const swapTarget = document.querySelector('#prompt-input');
            if (swapTarget) {
              const form = formWrapper.querySelector('form');
              if (swapTarget) {
                swapTarget.innerHTML = '';
                swapTarget.appendChild(form);
                waitForFormSubmission(form);
                htmx.process(formWrapper);
              }
            }
          }
        } else if (response.id === 'webchat_response_with_request') {
          htmx.process(response);
        } else {
          setTimeout(showNext, 1000);
        }

        current++;
      }

      function waitForFormSubmission(form) {
        form.addEventListener('submit', function(event) {
          event.preventDefault();
          htmx.process(form);
          showNext();
        });
      }
      showNext();
    })();
</script>
